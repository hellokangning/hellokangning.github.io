<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Consensus in Distributed System - Qing&#39;s Landing</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Guoqing Geng" />
  <meta name="description" content="The distributed consensus problem deals with reaching an agreement on a single data value among a group of process connected by an unreliable network. The processes must put forth their candidate values, communicate with one another, and agree on a single consensus value in presence of failures of some processes.
Examples of applications of consensus include:
 Leader election / Mutable Exclusion Commit or Abort in distributed transactions Reaching agreement about which process has failed Clock phase synchronization Load balancing  A visual diagram of this problem unfolds in the following. Each process pk with an input value uk runs a program to exchange its value. Finally the output of all non-faulty processes become identical. It is permissive that one or more processes may fail at any time, but the output v must be equal to the value of at least one process.
" />
<meta name="keywords" content="Consensus, Distributed System" />







<meta name="generator" content="Hugo 0.64.1" />


<link rel="canonical" href="https://hellokangning.github.io/en/post/consensus-in-distributed-system/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.0995afa14b62cd93e93cfc066b646c4c17a3eddca0e9d52a1d9dcf5d90aaacd3.css" integrity="sha256-CZWvoUtizZPpPPwGa2RsTBej7dyg6dUqHZ3PXZCqrNM=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Consensus in Distributed System" />
<meta property="og:description" content="The distributed consensus problem deals with reaching an agreement on a single data value among a group of process connected by an unreliable network. The processes must put forth their candidate values, communicate with one another, and agree on a single consensus value in presence of failures of some processes.
Examples of applications of consensus include:

Leader election / Mutable Exclusion
Commit or Abort in distributed transactions
Reaching agreement about which process has failed
Clock phase synchronization
Load balancing

A visual diagram of this problem unfolds in the following. Each process pk with an input value uk runs a program to exchange its value. Finally the output of all non-faulty processes become identical. It is permissive that one or more processes may fail at any time, but the output v must be equal to the value of at least one process.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hellokangning.github.io/en/post/consensus-in-distributed-system/" />
<meta property="article:published_time" content="2018-08-19T16:07:16+08:00" />
<meta property="article:modified_time" content="2018-08-22T14:05:16+08:00" />
<meta itemprop="name" content="Consensus in Distributed System">
<meta itemprop="description" content="The distributed consensus problem deals with reaching an agreement on a single data value among a group of process connected by an unreliable network. The processes must put forth their candidate values, communicate with one another, and agree on a single consensus value in presence of failures of some processes.
Examples of applications of consensus include:

Leader election / Mutable Exclusion
Commit or Abort in distributed transactions
Reaching agreement about which process has failed
Clock phase synchronization
Load balancing

A visual diagram of this problem unfolds in the following. Each process pk with an input value uk runs a program to exchange its value. Finally the output of all non-faulty processes become identical. It is permissive that one or more processes may fail at any time, but the output v must be equal to the value of at least one process.
">
<meta itemprop="datePublished" content="2018-08-19T16:07:16&#43;08:00" />
<meta itemprop="dateModified" content="2018-08-22T14:05:16&#43;08:00" />
<meta itemprop="wordCount" content="2343">



<meta itemprop="keywords" content="Mind Map," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Consensus in Distributed System"/>
<meta name="twitter:description" content="The distributed consensus problem deals with reaching an agreement on a single data value among a group of process connected by an unreliable network. The processes must put forth their candidate values, communicate with one another, and agree on a single consensus value in presence of failures of some processes.
Examples of applications of consensus include:

Leader election / Mutable Exclusion
Commit or Abort in distributed transactions
Reaching agreement about which process has failed
Clock phase synchronization
Load balancing

A visual diagram of this problem unfolds in the following. Each process pk with an input value uk runs a program to exchange its value. Finally the output of all non-faulty processes become identical. It is permissive that one or more processes may fail at any time, but the output v must be equal to the value of at least one process.
"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-105833321-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/en/" class="logo">Qing&#39;s Landing</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/zh/">中文</a>
          
        
      </li>
    

    
  </ul>
</nav>


  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/en/" class="logo">
    
      Qing&#39;s Landing
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/zh/">中文</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Consensus in Distributed System</h1>
      
      <div class="post-meta">
        <time datetime="2018-08-19" class="post-time">
          Aug 19, 2018
        </time>
        <div class="post-category">
            <a href="https://hellokangning.github.io/en/categories/distributed-system/"> Distributed System </a>
            
          </div>
        <span class="more-meta"> 2343 words </span>
          <span class="more-meta"> 11 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#2pc">2PC</a>
      <ul>
        <li><a href="#voting-phase">Voting Phase</a></li>
        <li><a href="#commit-phase">Commit Phase</a></li>
      </ul>
    </li>
    <li><a href="#3pc">3PC</a></li>
    <li><a href="#paxos">Paxos</a>
      <ul>
        <li><a href="#roles">Roles</a></li>
        <li><a href="#basic-paxos">Basic Paxos</a></li>
      </ul>
    </li>
    <li><a href="#raft">Raft</a>
      <ul>
        <li><a href="#leader-election">Leader Election</a></li>
        <li><a href="#log-replication">Log Replication</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>The distributed consensus problem deals with reaching an agreement on a single data value among a group of process connected by an unreliable network. The processes must put forth their candidate values, communicate with one another, and agree on a single consensus value in presence of failures of some processes.</p>
<p>Examples of applications of consensus include:</p>
<ul>
<li>Leader election / Mutable Exclusion</li>
<li>Commit or Abort in distributed transactions</li>
<li>Reaching agreement about which process has failed</li>
<li>Clock phase synchronization</li>
<li>Load balancing</li>
</ul>
<p>A visual diagram of this problem unfolds in the following. Each process <strong>p<!-- raw HTML omitted -->k<!-- raw HTML omitted --></strong> with an input value <strong>u<!-- raw HTML omitted -->k<!-- raw HTML omitted --></strong> runs a program to exchange its value. Finally the output of all non-faulty processes become identical. It is permissive that one or more processes may fail at any time, but the output <strong>v</strong> must be equal to the value of at least one process.</p>
<p><img src="/images/distributed-consensus-problem.png" alt=""></p>
<p>A global view of distributed system is here, from which you can know what kind of role consensus plays.</p>
<p><img src="/images/distributed-overview.png" alt=""></p>
<p>Protocols that solve consensus problems are designed to deal with limited numbers of faulty processes. A consensus protocol tolerating halting failures must satisfy the following properties.</p>
<ul>
<li>Termination. Every non-faulty process must eventually decide.</li>
<li>Agreement. The final decision of every non-faulty process must be identical.</li>
<li>Validity. If every non-faulty process begins with the same initial value <strong>v</strong>, then their final decision must be <strong>v</strong>.</li>
</ul>
<h1 id="the-byzantine-generals-problem">The Byzantine Generals&rsquo; Problem</h1>
<p>The Byzantine Generals&rsquo; Problem proposed by Leslie Lamport is a fault-tolerant problem in the distributed system, which is the most complex and rigorous fault-tolerant model.</p>
<p>In this model, the system does not impose any restrictions on the nodes in the cluster meaning they can send random data, even error data to other nodes, or choose not to respond to the requests from other nodes. These unpredictable behaviors make fault-tolerance more complicated.</p>
<p>This problem describes a scenario in which a group of generals leads a part of the army. Each general does not know whether the other generals are reliable or not, but they need to choose between attack and retreat.</p>
<p>It will be a serious problem if one of the generals tells that some of the generals attack and the others retreat. Because of a traitor or interception in the transmission, some generals choose to attack while the rest retreat. They all believe that their choices are approved by the majority.</p>
<p>The Byzantine Generals&rsquo; Problem is the highest requirement for fault tolerance in distributed system, not a problem in most distributed systems used in daily work. The most frequent problems we encounter cover node down and failure to respond, which is much simpler.</p>
<h1 id="flp">FLP</h1>
<p>FLP is one of the most significant theorems in distributed domain offering a proved conclusion.</p>
<blockquote>
<p>In a purely asynchronous distributed system, the consensus problem is impossible to solve if even a single process crashes.</p>
</blockquote>
<h1 id="consensus-protocols">Consensus Protocols</h1>
<h2 id="2pc">2PC</h2>
<p>In a distributed system, all nodes can know their own state after performing an operation, but it is impossible to know the state of other nodes. Two-phase Commit (commonly known as 2PC) introduces a coordinator to uniformly control all nodes and guide them to commit the operation result or not.</p>
<p>The execution of 2PC is divided into two phases, the voting phase and the commit phase.</p>
<p><img src="/images/distributed-2pc-sequence.jpg" alt=""></p>
<h3 id="voting-phase">Voting Phase</h3>
<p>In the voting phase, the coordinator asks the cohorts whether the operation can be executed. The cohorts will perform the corresponding operation and record the redo and rollback logs, all participants will send an COMMIT or ABORT to the coordinator indicating the result of the operation.</p>
<h3 id="commit-phase">Commit Phase</h3>
<p>If all cohorts say yes, the coordinator sends a COMMIT request to the participant, and the participant returns a completion message to the coordinator after finishing the operation and releasing the resource. The entire transaction is ended after coordinator receives the completion message.</p>
<p>In contrast, when a participant decides on ABORT current transaction, the coordinator sends a ROLLBACK request to all participants telling them rollback the operation based on the previous log.</p>
<p>One obvious drawback of 2PC is that it&rsquo;s a <strong>blocking protocol</strong>, that is to say, if the coordinator is permanently down or network issue happens, a part of the participants of the transaction will never be able to complete the transaction because of no COMMIT message is received.</p>
<h2 id="3pc">3PC</h2>
<p>Three-phase Commit protocol solves the above problem by:</p>
<ol>
<li>introducing timeout,</li>
<li>adding a prepare phase between. If the cohort cannot receiver COMMIT or ROLLBACK, it still release the resource.</li>
</ol>
<p><img src="/images/distributed-3pc-sequence.jpg" alt=""></p>
<p>The main disadvantage to this protocol is that it cannot recover in the event the network is segmented in any manner. The original 3PC assumes a fail-stop model, where processes fail by crashing and crashes can be accurately detected, and does not work with network partitions or asynchronous communication.</p>
<h2 id="paxos">Paxos</h2>
<p>Paxos is a family of protocols for solving consensus in a network of unreliable processors.</p>
<h3 id="roles">Roles</h3>
<p>Paxos describes the actions of the processors by their roles in the protocol: <em>acceptor</em>, <em>proposer</em>, <em>learner</em>, and <em>leader</em>. In typical implementations, a single processor may play one or more roles at the same time, not affecting the correctness of the protocol.</p>
<ul>
<li><strong>Proposer</strong>. A Proposer advocates a client request, attempting to convince the Acceptors to agree on it, and acting as a coordinator to move the protocol forward when conflicts occur.</li>
<li><strong>Acceptor (Voters)</strong>. The Acceptors act as the fault-tolerant &ldquo;memory&rdquo; of the protocol. Acceptors are collected into groups called Quorums. Any message sent to an Acceptor must be sent to a Quorum of Acceptors. Any message received from an Acceptor is ignored unless a copy is received from each Acceptor in a Quorum.</li>
<li><strong>Learner</strong>. Learners act as the replication factor for the protocol. Once a client request has been agreed on by the Acceptors, the Learner may take action (i.e.: execute the request and send a response to the client). To improve availability of processing, additional Learners can be added.</li>
<li><strong>Leader</strong>. Paxos requires a distinguished Proposer (called the leader) to make progress. Many processes may believe they are leaders, but the protocol only guarantees progress if one of them is eventually chosen. If two processes believe they are leaders, they may stall the protocol by continuously proposing conflicting updates. However, the safety properties are still preserved in that case.</li>
</ul>
<h3 id="basic-paxos">Basic Paxos</h3>
<p>This protocol is the most basic of the Paxos family. Each instance of the Basic Paxos protocol decides on a single output value. The protocol proceeds over several rounds ending until a successful one with two phases. A Proposer should not initiate Paxos if it cannot communicate with at least a Quorum of Acceptors.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Client   Proposer      Acceptor     Learner
   |         |          |  |  |       |  |
   X--------&gt;|          |  |  |       |  |  Request
   |         X---------&gt;|-&gt;|-&gt;|       |  |  Prepare(1)
   |         |&lt;---------X--X--X       |  |  Promise(1,{Va,Vb,Vc})
   |         X---------&gt;|-&gt;|-&gt;|       |  |  Accept!(1,Vn)
   |         |&lt;---------X--X--X------&gt;|-&gt;|  Accepted(1,Vn)
   |&lt;---------------------------------X--X  Response
   |         |          |  |  |       |  |
</code></pre></td></tr></table>
</div>
</div><p><strong>Phase 1a: Prepare</strong></p>
<p>A Proposer (Leader) creates a proposal identified with a number N. This number must be greater than any previous <em>proposal number</em> used by this Proposer. Then, it sends a <em>Prepare</em> message containing this proposal to a Quorum of Acceptors. The Proposer decides who is in the Quorum.</p>
<p><strong>Phase 1b: Promise</strong></p>
<p>If the proposal&rsquo;s number N is higher than any previous proposal number received from any Proposer by the Acceptor, then the Acceptor must return a promise to ignore all future proposals having a number less than N.</p>
<p>If the Acceptor accepted a proposal at some point in the past, it must include the previous proposal number and previous value in its response to the Proposer.</p>
<p>Otherwise, the Acceptor can ignore the received proposal. It does not have to answer in this case for Paxos to work. However, for the sake of optimization, sending a denial (Nack) response would tell the Proposer that it can stop its attempt to create consensus with proposal N.</p>
<p><strong>Phase 2a: Accept Request</strong></p>
<p>If a Proposer receives enough promises from a Quorum of Acceptors, it needs to set a value to its proposal.</p>
<p>If any Acceptors had previously accepted any proposal, then they&rsquo;ll have sent their values to the Proposer, who now must set the value of its proposal to the value associated with the highest proposal number reported by the Acceptors.</p>
<p>If none of the Acceptors had accepted a proposal up to this point, then the Proposer may choose the value it originally chose &lsquo;N&rsquo;.</p>
<p>The Proposer sends an Accept Request message to a Quorum of Acceptors with the chosen value for its proposal.</p>
<p><strong>Phase 2b: Accepted</strong></p>
<p>If an Acceptor receives an Accept Request message for a proposal N, it must accept it if and only if it has not already promised to only consider proposals having an identifier greater than N. In this case, it should register the corresponding value v and send an Accepted message to the Proposer and every Learner. Else, it can ignore the Accept Request.</p>
<p>Note that an Acceptor can accept multiple proposals. These proposals may even have different values in the presence of certain failures. However, the Paxos protocol will guarantee that the Acceptors will ultimately agree on a single value.</p>
<p>Rounds fail when multiple Proposers send conflicting Prepare messages, or when the Proposer does not receive a Quorum of responses (Promise or Accepted). In these cases, another round must be started with a higher proposal number.
Notice that when Acceptors accept a request, they also acknowledge the leadership of the Proposer. Hence, Paxos can be used to select a leader in a cluster of nodes.</p>
<p><strong>Examples of failure</strong></p>
<p>Failure of Acceptor (Quorum size = 2 Acceptors) is demonstrated in the following graphic representation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Client   Proposer      Acceptor     Learner
   |         |          |  |  |       |  |
   X--------&gt;|          |  |  |       |  |  Request
   |         X---------&gt;|-&gt;|-&gt;|       |  |  Prepare(1)
   |         |          |  |  !       |  |  !! FAIL !!
   |         |&lt;---------X--X          |  |  Promise(1,{Va, Vb, null})
   |         X---------&gt;|-&gt;|          |  |  Accept!(1,V)
   |         |&lt;---------X--X---------&gt;|-&gt;|  Accepted(1,V)
   |&lt;---------------------------------X--X  Response
   |         |          |  |          |  |
</code></pre></td></tr></table>
</div>
</div><p>Here is a graph for failure of redundant Learner.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Client   Proposer      Acceptor     Learner
   |         |          |  |  |       |  |
   X--------&gt;|          |  |  |       |  |  Request
   |         X---------&gt;|-&gt;|-&gt;|       |  |  Prepare(1)
   |         |&lt;---------X--X--X       |  |  Promise(1,{null,null,null})
   |         X---------&gt;|-&gt;|-&gt;|       |  |  Accept!(1,V)
   |         |&lt;---------X--X--X------&gt;|-&gt;|  Accepted(1,V)
   |         |          |  |  |       |  !  !! FAIL !!
   |&lt;---------------------------------X     Response
   |         |          |  |  |       |
</code></pre></td></tr></table>
</div>
</div><p>The next failure case is when a Proposer fails after proposing a value, but before agreement is reached.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Client  Proposer        Acceptor     Learner
   |      |             |  |  |       |  |
   X-----&gt;|             |  |  |       |  |  Request
   |      X------------&gt;|-&gt;|-&gt;|       |  |  Prepare(1)
   |      |&lt;------------X--X--X       |  |  Promise(1,{null, null, null})
   |      |             |  |  |       |  |
   |      |             |  |  |       |  |  !! Leader fails during broadcast !!
   |      X------------&gt;|  |  |       |  |  Accept!(1,V)
   |      !             |  |  |       |  |
   |         |          |  |  |       |  |  !! NEW LEADER !!
   |         X---------&gt;|-&gt;|-&gt;|       |  |  Prepare(2)
   |         |&lt;---------X--X--X       |  |  Promise(2,{V, null, null})
   |         X---------&gt;|-&gt;|-&gt;|       |  |  Accept!(2,V)
   |         |&lt;---------X--X--X------&gt;|-&gt;|  Accepted(2,V)
   |&lt;---------------------------------X--X  Response
   |         |          |  |  |       |  |
</code></pre></td></tr></table>
</div>
</div><h2 id="raft">Raft</h2>
<p>Raft is a consensus algorithm designed as an alternative to Paxos, which is more understandable by means of separation of logic.</p>
<p>Raft achieves consensus via an elected leader. A server in a raft cluster is either a <em>leader</em> or a <em>follower</em>, and can be a <em>candidate</em> in the precise case of an election (leader unavailable).</p>
<p>The leader regularly informs the followers of its existence by sending a <strong>heartbeat</strong> message. Each follower has a timeout in which it expects the heartbeat from the leader. The timeout is reset on receiving the heartbeat.</p>
<h3 id="leader-election">Leader Election</h3>
<p>If no heartbeat is received, the follower changes its status to candidate and starts a leader election.</p>
<p>In this case, a new <em>term</em> starts in the cluster. A term is an arbitrary period of time on the server during which a new leader needs to be elected. Each term starts with a leader election. If the election is completed successfully (i.e. a single leader is elected) the term keeps going with normal operations orchestrated by the new leader. If the election is a failure, a new term starts, with a new election.</p>
<p>A leader election is started by a candidate server. A server becomes a candidate if it receives no communication by the leader over a period called the election timeout, so it assumes there is no acting leader anymore. It starts the election by increasing the term counter, voting for itself as new leader, and sending a message to all other servers requesting their vote.</p>
<p>A server will vote <strong>only once per term</strong>, on a first-come-first-served basis. If a candidate receives a message from another server with a term number at least as large as the candidate&rsquo;s current term, then the candidate&rsquo;s election is defeated and the candidate changes into a follower and recognizes the leader as legitimate. If a candidate receives a majority of votes, then it becomes the new leader. If neither happens, e.g., because of a split vote, then a new term starts, and a new election begins.</p>
<h3 id="log-replication">Log Replication</h3>
<p>The leader is responsible for the log replication and also accepts client requests. Each client request consists of a command to be executed by the replicated state machines in the cluster.</p>
<p>After being appended to the leader&rsquo;s log as a new entry, each of the requests is forwarded to the followers as AppendEntries messages. In case of unavailability of the followers, the leader retries AppendEntries messages indefinitely, until the log entry is eventually stored by all of the followers.</p>
<p>Once the leader receives confirmation from the majority of its followers that the entry has been replicated, the leader applies the entry to its local state machine, and the request is considered committed.</p>
<p><strong>Reference</strong></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Consensus_(computer_science)">Consensus (computer science)</a></li>
<li><a href="homepage.divms.uiowa.edu/~ghosh/16612.week11.pdf">Distributed Consensus</a></li>
<li><a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos (computer science)</a></li>
<li><a href="https://raft.github.io/">The Raft Consensus Algorithm</a></li>
<li><a href="https://en.wikipedia.org/wiki/Raft_(computer_science)">Raft (computer science)</a></li>
<li><a href="http://dancres.github.io/Pages/">A Distributed Systems Reading List</a></li>
</ul>
    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://hellokangning.github.io/en/tags/mind-map/">Mind Map</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/en/post/handling-missing-keys-in-python/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Handling Missing Keys in Python</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/en/post/python-unpacking/">
            <span class="next-text nav-default">Unpacking in Python</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://hellokangning.github.io/en/post/consensus-in-distributed-system/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'guoqing';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:hellokangning@hotmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://www.linkedin.com/in/guoqing-geng-9032b820/" rel="me noopener" class="iconfont"
      title="linkedin"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="33" height="33">
  <path d="M872.405333 872.618667h-151.637333v-237.610667c0-56.661333-1.152-129.578667-79.018667-129.578667-79.061333 0-91.136 61.653333-91.136 125.397334v241.792H398.976V384h145.664v66.602667h1.962667c20.352-38.4 69.845333-78.933333 143.786666-78.933334 153.642667 0 182.058667 101.12 182.058667 232.746667v268.202667zM227.712 317.141333a87.978667 87.978667 0 0 1-88.021333-88.106666 88.064 88.064 0 1 1 88.021333 88.106666z m76.032 555.477334H151.68V384h152.064v488.618667zM948.266667 0H75.562667C33.792 0 0 33.024 0 73.770667v876.458666C0 991.018667 33.792 1024 75.562667 1024h872.576C989.866667 1024 1024 991.018667 1024 950.229333V73.770667C1024 33.024 989.866667 0 948.138667 0h0.128z"></path>
</svg>

    </a>
  
    <a href="https://github.com/hellokangning" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.douban.com/people/hellokangning/" rel="me noopener" class="iconfont"
      title="douban"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M926.917973 37.80608C959.65184 37.80608 986.19392 64.34816 986.19392 97.082027L986.19392 926.917973C986.19392 959.65184 959.65184 986.19392 926.917973 986.19392L97.082027 986.19392C64.34816 986.19392 37.80608 959.65184 37.80608 926.917973L37.80608 97.082027C37.80608 64.34816 64.34816 37.80608 97.082027 37.80608zM176.653653 176.19968 176.653653 252.678827 825.658027 252.678827 825.658027 176.19968zM217.719467 316.146347 217.719467 628.08064 273.524053 628.08064 341.292373 770.39616 157.259093 770.39616 157.259093 845.417813 842.949973 845.417813 842.949973 770.39616 654.226773 770.39616 722.899627 628.08064 783.67744 628.08064 783.67744 316.146347zM684.885333 392.891733 684.885333 553.987413 312.576 553.987413 312.576 392.891733zM570.770773 770.39616 426.653013 770.39616 359.621973 628.08064 639.443627 628.08064z"></path>
</svg>

    </a>
  
    <a href="https://www.instagram.com/hellokangning/" rel="me noopener" class="iconfont"
      title="instagram"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M853.333333 277.333333C853.333333 289.28 843.946667 298.666667 832 298.666667L746.666667 298.666667C734.72 298.666667 725.333333 289.28 725.333333 277.333333L725.333333 192C725.333333 180.053333 734.72 170.666667 746.666667 170.666667L832 170.666667C843.946667 170.666667 853.333333 180.053333 853.333333 192M192 853.333333C180.053333 853.333333 170.666667 843.946667 170.666667 832L170.666667 469.333333 259.84 469.333333C257.28 482.986667 256 497.493333 256 512 256 653.226667 370.773333 768 512 768 653.226667 768 768 653.226667 768 512 768 497.493333 766.293333 482.986667 764.16 469.333333L853.333333 469.333333 853.333333 832C853.333333 843.946667 843.946667 853.333333 832 853.333333M512 341.333333C606.293333 341.333333 682.666667 417.706667 682.666667 512 682.666667 606.293333 606.293333 682.666667 512 682.666667 417.706667 682.666667 341.333333 606.293333 341.333333 512 341.333333 417.706667 417.706667 341.333333 512 341.333333M853.333333 85.333333 170.666667 85.333333C123.306667 85.333333 85.333333 123.306667 85.333333 170.666667L85.333333 853.333333C85.333333 900.266667 123.733333 938.666667 170.666667 938.666667L853.333333 938.666667C900.266667 938.666667 938.666667 900.266667 938.666667 853.333333L938.666667 170.666667C938.666667 123.306667 900.266667 85.333333 853.333333 85.333333Z"></path>
</svg>

    </a>


<a href="https://hellokangning.github.io/en/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2016 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Guoqing Geng
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>


























</body>
</html>
