<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Java NIO: Selector - Qing&#39;s Landing</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Guoqing Geng" />
  <meta name="description" content="Taking FileChannel for example in the previous post may bewilder audiences: it&amp;rsquo;s non-blocking, so how does NIO achievement non-blocking? Here comes Selector.
A Selector is a Java NIO component which can examine one or more NIO Channel&amp;rsquo;s, and determine which channels are ready for reading or writing. A thread can manage multiply channels with Selector making multiple network connections feasible. This way avoids the cost of switching between threads which is expensive.
Here is an illustration of a thread using a Selector to handle 3 Channels:
" />
<meta name="keywords" content="Java, NIO, Selector" />







<meta name="generator" content="Hugo 0.64.1" />


<link rel="canonical" href="https://hellokangning.github.io/en/post/java-nio-selector/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.0995afa14b62cd93e93cfc066b646c4c17a3eddca0e9d52a1d9dcf5d90aaacd3.css" integrity="sha256-CZWvoUtizZPpPPwGa2RsTBej7dyg6dUqHZ3PXZCqrNM=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Java NIO: Selector" />
<meta property="og:description" content="Taking FileChannel for example in the previous post may bewilder audiences: it&rsquo;s non-blocking, so how does NIO achievement non-blocking? Here comes Selector.
A Selector is a Java NIO component which can examine one or more NIO Channel&rsquo;s, and determine which channels are ready for reading or writing. A thread can manage multiply channels with Selector making multiple network connections feasible. This way avoids the cost of switching between threads which is expensive.
Here is an illustration of a thread using a Selector to handle 3 Channels:
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hellokangning.github.io/en/post/java-nio-selector/" />
<meta property="article:published_time" content="2018-07-21T17:54:50+08:00" />
<meta property="article:modified_time" content="2018-07-21T17:54:50+08:00" />
<meta itemprop="name" content="Java NIO: Selector">
<meta itemprop="description" content="Taking FileChannel for example in the previous post may bewilder audiences: it&rsquo;s non-blocking, so how does NIO achievement non-blocking? Here comes Selector.
A Selector is a Java NIO component which can examine one or more NIO Channel&rsquo;s, and determine which channels are ready for reading or writing. A thread can manage multiply channels with Selector making multiple network connections feasible. This way avoids the cost of switching between threads which is expensive.
Here is an illustration of a thread using a Selector to handle 3 Channels:
">
<meta itemprop="datePublished" content="2018-07-21T17:54:50&#43;08:00" />
<meta itemprop="dateModified" content="2018-07-21T17:54:50&#43;08:00" />
<meta itemprop="wordCount" content="2095">



<meta itemprop="keywords" content="java.nio," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java NIO: Selector"/>
<meta name="twitter:description" content="Taking FileChannel for example in the previous post may bewilder audiences: it&rsquo;s non-blocking, so how does NIO achievement non-blocking? Here comes Selector.
A Selector is a Java NIO component which can examine one or more NIO Channel&rsquo;s, and determine which channels are ready for reading or writing. A thread can manage multiply channels with Selector making multiple network connections feasible. This way avoids the cost of switching between threads which is expensive.
Here is an illustration of a thread using a Selector to handle 3 Channels:
"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-105833321-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/en/" class="logo">Qing&#39;s Landing</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/zh/">中文</a>
          
        
      </li>
    

    
  </ul>
</nav>


  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/en/" class="logo">
    
      Qing&#39;s Landing
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://hellokangning.github.io/en/zh/">中文</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Java NIO: Selector</h1>
      
      <div class="post-meta">
        <time datetime="2018-07-21" class="post-time">
          Jul 21, 2018
        </time>
        <div class="post-category">
            <a href="https://hellokangning.github.io/en/categories/java/"> Java </a>
            
          </div>
        <span class="more-meta"> 2095 words </span>
          <span class="more-meta"> 5 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#interest-set">Interest Set</a></li>
    <li><a href="#ready-set">Ready Set</a></li>
    <li><a href="#channel--selector">Channel + Selector</a></li>
    <li><a href="#attaching-objects">Attaching Objects</a></li>
  </ul>

  <ul>
    <li><a href="#selectedkeys">selectedKeys()</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>Taking FileChannel for example in the <a href="https://hellokangning.github.io/en/post/java-nio-channel/">previous post</a> may bewilder audiences: it&rsquo;s non-blocking, so how does NIO achievement non-blocking? Here comes Selector.</p>
<p>A Selector is a Java NIO component which can examine one or more NIO Channel&rsquo;s, and determine which channels are ready for reading or writing. A thread can manage multiply channels with Selector making multiple network connections feasible. This way avoids the cost of switching between threads which is expensive.</p>
<p>Here is an illustration of a thread using a Selector to handle 3 Channels:</p>
<p><img src="/images/java-nio-selector-handle-channels.png" alt=""></p>
<h1 id="creating-a-selector">Creating a Selector</h1>
<p>You create a Selector by calling the Selector.open() method, like this: <code>Selector selector = Selector.open();</code>.</p>
<p>Loot at the multilevel inheritance hierarchy.</p>
<p><img src="/images/java-nio-selector-class.png" alt=""></p>
<p>Selector, even an abstract class, implements <code>open()</code> method to open a selector. The new selector is created by invoking <code>SelectorProvider#openSelector</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// Selector.java

public abstract class Selector implements Closeable {
    public static Selector open() throws IOException {
        return SelectorProvider.provider().openSelector();
    }
}
</code></pre></td></tr></table>
</div>
</div><p>Regarding to <code>SelectorProvider#openSelector</code>, is also abstract, but instantiates a system-default provider class.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectorProvider.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">SelectorProvider</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">SelectorProvider</span> <span class="n">provider</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">AbstractSelector</span> <span class="nf">openSelector</span><span class="o">(</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">SelectorProvider</span> <span class="nf">provider</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">lock</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">provider</span> <span class="o">!</span><span class="o">=</span> <span class="kc">null</span><span class="o">)</span>
                <span class="k">return</span> <span class="n">provider</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">AccessController</span><span class="o">.</span><span class="na">doPrivileged</span><span class="o">(</span>
                <span class="k">new</span> <span class="n">PrivilegedAction</span><span class="o">&lt;</span><span class="n">SelectorProvider</span><span class="o">&gt;</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kd">public</span> <span class="n">SelectorProvider</span> <span class="nf">run</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">loadProviderFromProperty</span><span class="o">(</span><span class="o">)</span><span class="o">)</span>
                                <span class="k">return</span> <span class="n">provider</span><span class="o">;</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">loadProviderAsService</span><span class="o">(</span><span class="o">)</span><span class="o">)</span>
                                <span class="k">return</span> <span class="n">provider</span><span class="o">;</span>
                            <span class="n">provider</span> <span class="o">=</span> <span class="n">sun</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">ch</span><span class="o">.</span><span class="na">DefaultSelectorProvider</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
                            <span class="k">return</span> <span class="n">provider</span><span class="o">;</span>
                        <span class="o">}</span>
                    <span class="o">}</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>For Linux, it&rsquo;s EpollSelectorProvider.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// DefaultSelectorProvider.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultSelectorProvider</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * Prevent instantiation.
</span><span class="cm">     */</span>
    <span class="kd">private</span> <span class="nf">DefaultSelectorProvider</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * Returns the default SelectorProvider.
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">SelectorProvider</span> <span class="nf">create</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">EPollSelectorProvider</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="registering-channels-with-the-selector">Registering Channels with the Selector</h1>
<p>Before you use a Channel with a Selector, you must register the Channel with the Selector. Calling <code>SelectableChannel.register()</code> method can attain that.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">channel</span><span class="o">.</span><span class="na">configureBlocking</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span><span class="o">;</span>
<span class="n">SelectionKey</span> <span class="n">key</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">selector</span><span class="o">,</span> <span class="n">SelectionKey</span><span class="o">.</span><span class="na">OP_READ</span><span class="o">)</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Only SelectableChannel can register with Selector, and the children of SelectableChannel must implement <code>configureBlocking</code>, which excludes FileChannel.</p>
<p>AbstractSelectableChannel, the child of SelectableChannel implements <code>register()</code> method by the following steps:</p>
<ul>
<li>get the lock</li>
<li>check if this channel is open</li>
<li>check whether or not the events you want to listen for is valid</li>
<li>check if this channel is in blocking mode</li>
<li>check if thew keys have been created</li>
<li>call <code>AbstractSelector#register</code> method</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// AbstractSelectableChannel.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">final</span> <span class="n">SelectionKey</span> <span class="nf">register</span><span class="o">(</span><span class="n">Selector</span> <span class="n">sel</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ops</span><span class="o">,</span>
                                   <span class="n">Object</span> <span class="n">att</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">ClosedChannelException</span>
<span class="o">{</span>
    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">regLock</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="o">!</span><span class="n">isOpen</span><span class="o">(</span><span class="o">)</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ClosedChannelException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="o">(</span><span class="n">ops</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">validOps</span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">blocking</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalBlockingModeException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">SelectionKey</span> <span class="n">k</span> <span class="o">=</span> <span class="n">findKey</span><span class="o">(</span><span class="n">sel</span><span class="o">)</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">!</span><span class="o">=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">k</span><span class="o">.</span><span class="na">interestOps</span><span class="o">(</span><span class="n">ops</span><span class="o">)</span><span class="o">;</span>
            <span class="n">k</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">att</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">=</span><span class="o">=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// New registration
</span><span class="c1"></span>            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">keyLock</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="o">!</span><span class="n">isOpen</span><span class="o">(</span><span class="o">)</span><span class="o">)</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="n">ClosedChannelException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
                <span class="n">k</span> <span class="o">=</span> <span class="o">(</span><span class="o">(</span><span class="n">AbstractSelector</span><span class="o">)</span><span class="n">sel</span><span class="o">)</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">ops</span><span class="o">,</span> <span class="n">att</span><span class="o">)</span><span class="o">;</span>
                <span class="n">addKey</span><span class="o">(</span><span class="n">k</span><span class="o">)</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As to <code>AbstractSelector#register</code>, SelectorImpl derived from AbstractSelector implements the <code>register</code> method but leaves central work to an abstract method <code>impleRegister</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectorImpl.java
</span><span class="c1"></span>
<span class="kd">protected</span> <span class="kd">final</span> <span class="n">SelectionKey</span> <span class="nf">register</span><span class="o">(</span><span class="n">AbstractSelectableChannel</span> <span class="n">ch</span><span class="o">,</span>
                                      <span class="kt">int</span> <span class="n">ops</span><span class="o">,</span>
                                      <span class="n">Object</span> <span class="n">attachment</span><span class="o">)</span>
<span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="o">!</span><span class="o">(</span><span class="n">ch</span> <span class="k">instanceof</span> <span class="n">SelChImpl</span><span class="o">)</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalSelectorException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
    <span class="n">SelectionKeyImpl</span> <span class="n">k</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SelectionKeyImpl</span><span class="o">(</span><span class="o">(</span><span class="n">SelChImpl</span><span class="o">)</span><span class="n">ch</span><span class="o">,</span> <span class="k">this</span><span class="o">)</span><span class="o">;</span>
    <span class="n">k</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">attachment</span><span class="o">)</span><span class="o">;</span>
    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">publicKeys</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">implRegister</span><span class="o">(</span><span class="n">k</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">k</span><span class="o">.</span><span class="na">interestOps</span><span class="o">(</span><span class="n">ops</span><span class="o">)</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">k</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">implRegister</span><span class="o">(</span><span class="n">SelectionKeyImpl</span> <span class="n">ski</span><span class="o">)</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>EPollSelectorImpl, the offspring of SelectorImpl fills <code>impleRegister</code>. Few member variables invloved include:</p>
<ul>
<li>closed: True if this Selector has been closed</li>
<li>fdToKey: Maps from file descriptors to keys</li>
<li>pollWrapper: The poll object</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// EPollSelectorImpl.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">EPollSelectorImpl</span>
    <span class="kd">extends</span> <span class="n">SelectorImpl</span>
<span class="o">{</span>
    <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">closed</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">SelectionKeyImpl</span><span class="o">&gt;</span> <span class="n">fdToKey</span><span class="o">;</span>
    <span class="n">EPollArrayWrapper</span> <span class="n">pollWrapper</span><span class="o">;</span>


    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">implRegister</span><span class="o">(</span><span class="n">SelectionKeyImpl</span> <span class="n">ski</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">closed</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ClosedSelectorException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">SelChImpl</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="na">channel</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">ch</span><span class="o">.</span><span class="na">getFDVal</span><span class="o">(</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>
        <span class="n">fdToKey</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">fd</span><span class="o">,</span> <span class="n">ski</span><span class="o">)</span><span class="o">;</span>
        <span class="n">pollWrapper</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">fd</span><span class="o">)</span><span class="o">;</span>
        <span class="n">keys</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ski</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Notice the second parameter of the <code>register()</code> method. This is an &ldquo;interest set&rdquo;, meaning what events you are interested in listening for in the Channel, via the Selector. There are four different events you can listen for and represented by the four SelectionKey constants:</p>
<table>
<thead>
<tr>
<th>Event</th>
<th>SelecttionKey constant</th>
</tr>
</thead>
<tbody>
<tr>
<td>Connect</td>
<td>SelectionKey.OP_CONNECT</td>
</tr>
<tr>
<td>Accept</td>
<td>SelectionKey.OP_ACCEPT</td>
</tr>
<tr>
<td>Read</td>
<td>SelectionKey.OP_READ</td>
</tr>
<tr>
<td>Write</td>
<td>SelectionKey.OP_WRITE</td>
</tr>
</tbody>
</table>
<h1 id="selectionkey">SelectionKey</h1>
<p>When you register a channel with a <code>Selector</code> the <code>Channel.register()</code> method returns a <code>SelectionKey</code>object. This key represents that channels registration with that selector.</p>
<p>This <code>SelectionKey</code> object contains a few interesting properties:</p>
<ul>
<li>The interest set</li>
<li>The ready set</li>
<li>The Channel</li>
<li>The Selector</li>
<li>An attached object (optional)</li>
</ul>
<h2 id="interest-set">Interest Set</h2>
<p>The interest set determines which operation categories will be tested for readiness the next time one of the selector&rsquo;s selection methods is invoked.  The interest set is initialized with the value given when the key is created; it may later be changed via the <code>interestOps(int)</code> method or retrieves via the <code>interestOps()</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectionKey.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">SelectionKey</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">interestOps</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">SelectionKey</span> <span class="nf">interestOps</span><span class="o">(</span><span class="kt">int</span> <span class="n">ops</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>you can AND the interest set with the given <code>SelectionKey</code> constant to find out if a certain event is in the interest set.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">interestSet</span> <span class="o">=</span> <span class="n">selectionKey</span><span class="o">.</span><span class="na">interestOps</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

<span class="kt">boolean</span> <span class="n">isInterestedInAccept</span>  <span class="o">=</span> <span class="n">interestSet</span> <span class="o">&amp;</span> <span class="n">SelectionKey</span><span class="o">.</span><span class="na">OP_ACCEPT</span><span class="o">;</span>
<span class="kt">boolean</span> <span class="n">isInterestedInConnect</span> <span class="o">=</span> <span class="n">interestSet</span> <span class="o">&amp;</span> <span class="n">SelectionKey</span><span class="o">.</span><span class="na">OP_CONNECT</span><span class="o">;</span>
<span class="kt">boolean</span> <span class="n">isInterestedInRead</span>    <span class="o">=</span> <span class="n">interestSet</span> <span class="o">&amp;</span> <span class="n">SelectionKey</span><span class="o">.</span><span class="na">OP_READ</span><span class="o">;</span>
<span class="kt">boolean</span> <span class="n">isInterestedInWrite</span>   <span class="o">=</span> <span class="n">interestSet</span> <span class="o">&amp;</span> <span class="n">SelectionKey</span><span class="o">.</span><span class="na">OP_WRITE</span><span class="o">;</span>  
</code></pre></td></tr></table>
</div>
</div><p>The implementation of <code>interestOps</code> lies in SelectionKeyImpl.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectionKeyImpl.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelectionKeyImpl</span>
    <span class="kd">extends</span> <span class="n">AbstractSelectionKey</span>
<span class="o">{</span>
	<span class="kd">final</span> <span class="n">SelChImpl</span> <span class="n">channel</span><span class="o">;</span> 
    <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">int</span> <span class="n">interestOps</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureValid</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="o">!</span><span class="n">isValid</span><span class="o">(</span><span class="o">)</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">CancelledKeyException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">interestOps</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ensureValid</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">interestOps</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">SelectionKey</span> <span class="nf">interestOps</span><span class="o">(</span><span class="kt">int</span> <span class="n">ops</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ensureValid</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">nioInterestOps</span><span class="o">(</span><span class="n">ops</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="n">SelectionKey</span> <span class="nf">nioInterestOps</span><span class="o">(</span><span class="kt">int</span> <span class="n">ops</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="o">(</span><span class="n">ops</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">channel</span><span class="o">(</span><span class="o">)</span><span class="o">.</span><span class="na">validOps</span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">channel</span><span class="o">.</span><span class="na">translateAndSetInterestOps</span><span class="o">(</span><span class="n">ops</span><span class="o">,</span> <span class="k">this</span><span class="o">)</span><span class="o">;</span>
        <span class="n">interestOps</span> <span class="o">=</span> <span class="n">ops</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The child of Channel, SocketChannelImpl here, translates native poll revent ops into a ready operation ops with <code>SocketChannelImpl#translateAndSetInterestOps</code> method.</p>
<h2 id="ready-set">Ready Set</h2>
<p>The ready set identifies the operation categories for which the key&rsquo;s channel has been detected to be ready by the key&rsquo;s selector. The ready set is initialized to zero when the key is created; it may later be updated by the selector during a selection operation, but it cannot be updated directly.</p>
<p>The <code>readyOps()</code> method in SelectionKey opens the door to retrieve this key&rsquo;s ready-operation set.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectionKey.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">SelectionKey</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">readyOps</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can test in the same way as with the interest set, what events / operations the channel is ready for. But, you can also use these four methods instead, which all reaturn a boolean:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">selectionKey.isAcceptable();
selectionKey.isConnectable();
selectionKey.isReadable();
selectionKey.isWritable();
</code></pre></td></tr></table>
</div>
</div><h2 id="channel--selector">Channel + Selector</h2>
<p>Accessing the channel + selector from the <code>SelectionKey</code> is trivial. Here is how it&rsquo;s done:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Channel  channel  = selectionKey.channel();
Selector selector = selectionKey.selector();  
</code></pre></td></tr></table>
</div>
</div><p>Remember the structure of SelectionKeyImpl? It has a package-private member named <code>channel</code> and  a public one <code>selector</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectionKeyImpl.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelectionKeyImpl</span>
    <span class="kd">extends</span> <span class="n">AbstractSelectionKey</span>
<span class="o">{</span>
	<span class="kd">final</span> <span class="n">SelChImpl</span> <span class="n">channel</span><span class="o">;</span>                            <span class="c1">// package-private
</span><span class="c1"></span>	<span class="kd">public</span> <span class="kd">final</span> <span class="n">SelectorImpl</span> <span class="n">selector</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">SelectableChannel</span> <span class="nf">channel</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">SelectableChannel</span><span class="o">)</span><span class="n">channel</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="n">Selector</span> <span class="nf">selector</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">selector</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="attaching-objects">Attaching Objects</h2>
<p>You can attach an object to a SelectionKey providing a handy way of recognizing a given channel.</p>
<p>Here is how you attach objects:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">selectionKey</span><span class="o">.</span><span class="na">attach</span><span class="o">(</span><span class="n">theObject</span><span class="o">)</span><span class="o">;</span>
<span class="n">Object</span> <span class="n">attachedObj</span> <span class="o">=</span> <span class="n">selectionKey</span><span class="o">.</span><span class="na">attachment</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>AtomicReferenceFieldUpdater, a reflection-based utility, is engaged in to that enable atomic updates to designated volatile reference fields of designated classes.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectionKey.java
</span><span class="c1"></span>    
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">SelectionKey</span> <span class="o">{</span>    
    <span class="kd">private</span> <span class="kd">volatile</span> <span class="n">Object</span> <span class="n">attachment</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">AtomicReferenceFieldUpdater</span><span class="o">&lt;</span><span class="n">SelectionKey</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span>
        <span class="n">attachmentUpdater</span> <span class="o">=</span> <span class="n">AtomicReferenceFieldUpdater</span><span class="o">.</span><span class="na">newUpdater</span><span class="o">(</span>
            <span class="n">SelectionKey</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&#34;attachment&#34;</span>
        <span class="o">)</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="n">Object</span> <span class="nf">attach</span><span class="o">(</span><span class="n">Object</span> <span class="n">ob</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachmentUpdater</span><span class="o">.</span><span class="na">getAndSet</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">ob</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="n">Object</span> <span class="nf">attachment</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">attachment</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="selecting-channels-via-a-selector">Selecting Channels via a Selector</h1>
<p>Once you have registered one or more channels with a Selector, you can call one of the <code>select()</code> methods.  These methods select a set of keys whose corresponding channels are ready for I/O perations(connect, accept, read or write).</p>
<p>Here are the select() methods:</p>
<ul>
<li><code>int select()</code> performs a blocking selection operation. It returns only after at least one channel is selected, this selector&rsquo;s <code>wakeup</code> method is invoked, or the current thread is interrupted, whichever comes first.</li>
<li><code>int select(long timeout)</code> does the same as <code>select()</code> except it blocks for a maximum of timeout milliseconds.</li>
<li><code>int selectNow()</code> performs a non-blocking selection operation.  If no channels have become selectable since the previous selection operation then this method immediately returns zero. Invoking this method clears the effect of any previous invocations of the <code>wakeup</code> method.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectorImpl.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">SelectorImpl</span>
    <span class="kd">extends</span> <span class="n">AbstractSelector</span>
<span class="o">{</span>
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">doSelect</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">select</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">IOException</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">timeout</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Negative timeout&#34;</span><span class="o">)</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">lockAndDoSelect</span><span class="o">(</span><span class="o">(</span><span class="n">timeout</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">?</span> <span class="o">-</span><span class="n">1</span> <span class="o">:</span> <span class="n">timeout</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">select</span><span class="o">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">select</span><span class="o">(</span><span class="n">0</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">selectNow</span><span class="o">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">lockAndDoSelect</span><span class="o">(</span><span class="n">0</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">lockAndDoSelect</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="o">!</span><span class="n">isOpen</span><span class="o">(</span><span class="o">)</span><span class="o">)</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClosedSelectorException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">publicKeys</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="n">publicSelectedKeys</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="n">doSelect</span><span class="o">(</span><span class="n">timeout</span><span class="o">)</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>SelectorImpl leaves <code>doSelect(long)</code> unimplemented to its derived class. Let&rsquo;s see what EPollSelectorImpl does.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// EPollSelectorImpl.java
</span><span class="c1"></span>
<span class="kd">class</span> <span class="nc">EPollSelectorImpl</span>
    <span class="kd">extends</span> <span class="n">SelectorImpl</span>
<span class="o">{</span>
    <span class="kd">protected</span> <span class="kt">int</span> <span class="nf">doSelect</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">closed</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ClosedSelectorException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="n">processDeregisterQueue</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">begin</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
            <span class="n">pollWrapper</span><span class="o">.</span><span class="na">poll</span><span class="o">(</span><span class="n">timeout</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">end</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">processDeregisterQueue</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">numKeysUpdated</span> <span class="o">=</span> <span class="n">updateSelectedKeys</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pollWrapper</span><span class="o">.</span><span class="na">interrupted</span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Clear the wakeup pipe
</span><span class="c1"></span>            <span class="n">pollWrapper</span><span class="o">.</span><span class="na">putEventOps</span><span class="o">(</span><span class="n">pollWrapper</span><span class="o">.</span><span class="na">interruptedIndex</span><span class="o">(</span><span class="o">)</span><span class="o">,</span> <span class="n">0</span><span class="o">)</span><span class="o">;</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">interruptLock</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">pollWrapper</span><span class="o">.</span><span class="na">clearInterrupted</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
                <span class="n">IOUtil</span><span class="o">.</span><span class="na">drain</span><span class="o">(</span><span class="n">fd0</span><span class="o">)</span><span class="o">;</span>
                <span class="n">interruptTriggered</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">numKeysUpdated</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>EPollSelectorImpl appeals to EPollArrayWrapper who manipulates a native array of <code>epoll_event</code> structs on Linux. The int returned by the <code>select()</code> methods tells how many channels are ready.</p>
<h2 id="selectedkeys"><code>selectedKeys()</code></h2>
<p>Once you have called one of the <code>select()</code> methods and its return value has indicated that one or more channels are ready, you can access the ready channels via the &ldquo;selected key set&rdquo;, by calling the selectors selectedKeys() method. Here is how that looks:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Set</span><span class="o">&lt;</span><span class="n">SelectionKey</span><span class="o">&gt;</span> <span class="n">selectedKeys</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="na">selectedKeys</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>  
</code></pre></td></tr></table>
</div>
</div><p>The implementation of <code>selectedKeys()</code> is in SelectorImpl using a Set named <code>publicSelectedKeys</code> to store keys that are going to be selected.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SelectorImpl.java
</span><span class="c1"></span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">SelectorImpl</span>
    <span class="kd">extends</span> <span class="n">AbstractSelector</span>
<span class="o">{</span>
    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">SelectionKey</span><span class="o">&gt;</span> <span class="n">publicKeys</span><span class="o">;</span>             <span class="c1">// Immutable
</span><span class="c1"></span>    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">SelectionKey</span><span class="o">&gt;</span> <span class="n">publicSelectedKeys</span><span class="o">;</span>     <span class="c1">// Removal allowed, but not addition
</span><span class="c1"></span>
    <span class="kd">public</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">SelectionKey</span><span class="o">&gt;</span> <span class="nf">selectedKeys</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="o">!</span><span class="n">isOpen</span><span class="o">(</span><span class="o">)</span> <span class="o">&amp;</span><span class="o">&amp;</span> <span class="o">!</span><span class="n">Util</span><span class="o">.</span><span class="na">atBugLevel</span><span class="o">(</span><span class="s">&#34;1.4&#34;</span><span class="o">)</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">ClosedSelectorException</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">publicSelectedKeys</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>When you register a channel with a Selector the <code>Channel.register()</code> method returns a SelectionKey object. This key represents that channels registration with that selector. It is these keys you can access via the <code>selectedKeySet() </code>method from the SelectionKey.</p>
<p>You can iterate this selected key set to access the ready channels. Here is how that looks:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Set</span><span class="o">&lt;</span><span class="n">SelectionKey</span><span class="o">&gt;</span> <span class="n">selectedKeys</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="na">selectedKeys</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

<span class="n">Iterator</span><span class="o">&lt;</span><span class="n">SelectionKey</span><span class="o">&gt;</span> <span class="n">keyIterator</span> <span class="o">=</span> <span class="n">selectedKeys</span><span class="o">.</span><span class="na">iterator</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

<span class="k">while</span><span class="o">(</span><span class="n">keyIterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">{</span>
    
    <span class="n">SelectionKey</span> <span class="n">key</span> <span class="o">=</span> <span class="n">keyIterator</span><span class="o">.</span><span class="na">next</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>

    <span class="k">if</span><span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">isAcceptable</span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// a connection was accepted by a ServerSocketChannel.
</span><span class="c1"></span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">isConnectable</span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// a connection was established with a remote server.
</span><span class="c1"></span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">isReadable</span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// a channel is ready for reading
</span><span class="c1"></span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">isWritable</span><span class="o">(</span><span class="o">)</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// a channel is ready for writing
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="n">keyIterator</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Notice the <code>keyIterator.remove()</code> call at the end of each iteration. The Selector does not remove the SelectionKey instances from the selected key set itself. You have to do this, when you are done processing the channel. The next time the channel becomes &ldquo;ready&rdquo; the Selector will add it to the selected key set again.</p>
<p><strong>Reference</strong></p>
<ul>
<li><a href="http://tutorials.jenkov.com/java-nio/index.html">Java NIO Tutorial</a></li>
<li><a href="https://www.javacodegeeks.com/2018/07/java-nio-tutorial.html">Java NIO Tutorial</a></li>
<li><a href="https://juejin.im/post/5af942c6f265da0b7026050c">nio你了解多少？</a></li>
</ul>
    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://hellokangning.github.io/en/tags/java.nio/">java.nio</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/en/post/binary-search-for-upper-bound/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Binary Search for Upper Bound</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/en/post/java-nio-channel/">
            <span class="next-text nav-default">Java NIO: Channel</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://hellokangning.github.io/en/post/java-nio-selector/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'guoqing';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:hellokangning@hotmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://www.linkedin.com/in/guoqing-geng-9032b820/" rel="me noopener" class="iconfont"
      title="linkedin"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="33" height="33">
  <path d="M872.405333 872.618667h-151.637333v-237.610667c0-56.661333-1.152-129.578667-79.018667-129.578667-79.061333 0-91.136 61.653333-91.136 125.397334v241.792H398.976V384h145.664v66.602667h1.962667c20.352-38.4 69.845333-78.933333 143.786666-78.933334 153.642667 0 182.058667 101.12 182.058667 232.746667v268.202667zM227.712 317.141333a87.978667 87.978667 0 0 1-88.021333-88.106666 88.064 88.064 0 1 1 88.021333 88.106666z m76.032 555.477334H151.68V384h152.064v488.618667zM948.266667 0H75.562667C33.792 0 0 33.024 0 73.770667v876.458666C0 991.018667 33.792 1024 75.562667 1024h872.576C989.866667 1024 1024 991.018667 1024 950.229333V73.770667C1024 33.024 989.866667 0 948.138667 0h0.128z"></path>
</svg>

    </a>
  
    <a href="https://github.com/hellokangning" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.douban.com/people/hellokangning/" rel="me noopener" class="iconfont"
      title="douban"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M926.917973 37.80608C959.65184 37.80608 986.19392 64.34816 986.19392 97.082027L986.19392 926.917973C986.19392 959.65184 959.65184 986.19392 926.917973 986.19392L97.082027 986.19392C64.34816 986.19392 37.80608 959.65184 37.80608 926.917973L37.80608 97.082027C37.80608 64.34816 64.34816 37.80608 97.082027 37.80608zM176.653653 176.19968 176.653653 252.678827 825.658027 252.678827 825.658027 176.19968zM217.719467 316.146347 217.719467 628.08064 273.524053 628.08064 341.292373 770.39616 157.259093 770.39616 157.259093 845.417813 842.949973 845.417813 842.949973 770.39616 654.226773 770.39616 722.899627 628.08064 783.67744 628.08064 783.67744 316.146347zM684.885333 392.891733 684.885333 553.987413 312.576 553.987413 312.576 392.891733zM570.770773 770.39616 426.653013 770.39616 359.621973 628.08064 639.443627 628.08064z"></path>
</svg>

    </a>
  
    <a href="https://www.instagram.com/hellokangning/" rel="me noopener" class="iconfont"
      title="instagram"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M853.333333 277.333333C853.333333 289.28 843.946667 298.666667 832 298.666667L746.666667 298.666667C734.72 298.666667 725.333333 289.28 725.333333 277.333333L725.333333 192C725.333333 180.053333 734.72 170.666667 746.666667 170.666667L832 170.666667C843.946667 170.666667 853.333333 180.053333 853.333333 192M192 853.333333C180.053333 853.333333 170.666667 843.946667 170.666667 832L170.666667 469.333333 259.84 469.333333C257.28 482.986667 256 497.493333 256 512 256 653.226667 370.773333 768 512 768 653.226667 768 768 653.226667 768 512 768 497.493333 766.293333 482.986667 764.16 469.333333L853.333333 469.333333 853.333333 832C853.333333 843.946667 843.946667 853.333333 832 853.333333M512 341.333333C606.293333 341.333333 682.666667 417.706667 682.666667 512 682.666667 606.293333 606.293333 682.666667 512 682.666667 417.706667 682.666667 341.333333 606.293333 341.333333 512 341.333333 417.706667 417.706667 341.333333 512 341.333333M853.333333 85.333333 170.666667 85.333333C123.306667 85.333333 85.333333 123.306667 85.333333 170.666667L85.333333 853.333333C85.333333 900.266667 123.733333 938.666667 170.666667 938.666667L853.333333 938.666667C900.266667 938.666667 938.666667 900.266667 938.666667 853.333333L938.666667 170.666667C938.666667 123.306667 900.266667 85.333333 853.333333 85.333333Z"></path>
</svg>

    </a>


<a href="https://hellokangning.github.io/en/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2016 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Guoqing Geng
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>


























</body>
</html>
