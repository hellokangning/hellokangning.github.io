<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Differences between Hashtable and HashMap - Qing&#39;s Landing</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Guoqing Geng" /><meta name="description" content="As I mentioned before, it is vital to read code with prepared questions. Hum, How about reading code with answers? The differences between Hashtable and HashMap have been explained many times including,
 null key &amp;amp; null value synchronized or not Enumeration and Iterator hash method  I am wondering how these arguments are supported by code. This post will give a view of code illustrating the above confusion.
" /><meta name="keywords" content="Java, HashMap, Hashtable" />






<meta name="generator" content="Hugo 0.52 with even 4.0.0" />


<link rel="canonical" href="https://hellokangning.github.io/en/post/java-hashtable-comparing-with-hashmap/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.93844dae.min.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Differences between Hashtable and HashMap" />
<meta property="og:description" content="As I mentioned before, it is vital to read code with prepared questions. Hum, How about reading code with answers? The differences between Hashtable and HashMap have been explained many times including,


null key &amp; null value
synchronized or not
Enumeration and Iterator
hash method


I am wondering how these arguments are supported by code. This post will give a view of code illustrating the above confusion." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hellokangning.github.io/en/post/java-hashtable-comparing-with-hashmap/" /><meta property="article:published_time" content="2016-08-05T12:01:40&#43;08:00"/>
<meta property="article:modified_time" content="2018-08-05T12:01:40&#43;08:00"/>

<meta itemprop="name" content="Differences between Hashtable and HashMap">
<meta itemprop="description" content="As I mentioned before, it is vital to read code with prepared questions. Hum, How about reading code with answers? The differences between Hashtable and HashMap have been explained many times including,


null key &amp; null value
synchronized or not
Enumeration and Iterator
hash method


I am wondering how these arguments are supported by code. This post will give a view of code illustrating the above confusion.">


<meta itemprop="datePublished" content="2016-08-05T12:01:40&#43;08:00" />
<meta itemprop="dateModified" content="2018-08-05T12:01:40&#43;08:00" />
<meta itemprop="wordCount" content="1205">



<meta itemprop="keywords" content="java.util,Data Structure," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Differences between Hashtable and HashMap"/>
<meta name="twitter:description" content="As I mentioned before, it is vital to read code with prepared questions. Hum, How about reading code with answers? The differences between Hashtable and HashMap have been explained many times including,


null key &amp; null value
synchronized or not
Enumeration and Iterator
hash method


I am wondering how these arguments are supported by code. This post will give a view of code illustrating the above confusion."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/en/" class="logo">Qing&#39;s Landing</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/en/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/en/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/en/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/en/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/zh/">
        <li class="mobile-menu-item">中文</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/en/" class="logo">Qing&#39;s Landing</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/en/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/en/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/zh/">中文</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Differences between Hashtable and HashMap</h1>

      <div class="post-meta">
        <span class="post-time"> Aug 05, 2016 </span>
        <div class="post-category">
            <a href="/en/categories/java/"> Java </a>
            </div>
          <span class="more-meta"> 1205 words </span>
          <span class="more-meta"> 6 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li><a href="#hierarchy">Hierarchy</a></li>
<li><a href="#enumeration">Enumeration</a></li>
<li><a href="#synchronized">Synchronized</a></li>
<li><a href="#null-support"><code>null</code> Support</a></li>
<li><a href="#increasing-the-capacity">Increasing the Capacity</a></li>
<li><a href="#hash">Hash</a></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>As I mentioned before, it is vital to read code with prepared questions. Hum, How about reading code with answers? The differences between Hashtable and HashMap have been explained many times including,</p>

<ul>
<li>null key &amp; null value</li>
<li>synchronized or not</li>
<li>Enumeration and Iterator</li>
<li>hash method</li>
</ul>

<p>I am wondering how these arguments are supported by code. This post will give a view of code illustrating the above confusion.</p>

<h1 id="hierarchy">Hierarchy</h1>

<p><img src="/images/java-hashtable-class.png" alt="" /></p>

<p>Hashtable implements Map interfance just as HashMap does. But unlike HashMap, Hashtable inherits from Dictionary with extra methods: <code>keys()</code> and <code>elements()</code>.</p>

<ul>
<li><code>keys()</code> returns an enumeration of the keys in this dictionary.</li>
<li><code>elements</code> returns an enumeration of the values in this dictionary.</li>
</ul>

<h1 id="enumeration">Enumeration</h1>

<p>Then here comes the first difference comparing with HashMap, Hashtable introduces Enumerator class implementing both the Enumeration and Iterator interfaces.</p>

<p>Let&rsquo;s look at the excerpt from Hashtable.java.</p>

<blockquote>
<p>The iterators returned by the <code>iterator</code> method of the collections returned by all of this class&rsquo;s &ldquo;collection view methods&rdquo; are fail-fast if the Hashtable is structurally modified at any time after the iterator is created, in any way except through the iterator&rsquo;s own <code>remove</code> method, the iterator will throw a <code>ConcurrentModificationException</code>. Thus, in the face of concurrent modification, the iterator fails quickly and cleanly, rather than risking arbitrary, non-deterministic behavior at an undetermined time in the future. The Enumerations returned by Hashtable&rsquo;s keys and elements methods are
not fail-fast.</p>
</blockquote>

<p>Take <code>keys()</code> for example, it will construct an instance of <code>Enumerator</code> directly.</p>

<pre><code class="language-java">// Hashtable.java

public synchronized Enumeration&lt;K&gt; keys() {
    return this.&lt;K&gt;getEnumeration(KEYS);
}

private &lt;T&gt; Enumeration&lt;T&gt; getEnumeration(int type) {
    if (count == 0) {
        return Collections.emptyEnumeration();
    } else {
        return new Enumerator&lt;&gt;(type, false);
    }
}
</code></pre>

<p>The code of <code>Enumerator</code>, a private and nested class in Hashtable.java, lists here.</p>

<pre><code class="language-java">// Hashtable.java

private class Enumerator&lt;T&gt; implements Enumeration&lt;T&gt;, Iterator&lt;T&gt; {
    Entry&lt;?,?&gt;[] table = Hashtable.this.table;
    int index = table.length;
    Entry&lt;?,?&gt; entry;
    Entry&lt;?,?&gt; lastReturned;
    int type;

    /**
     * Indicates whether this Enumerator is serving as an Iterator
     * or an Enumeration.  (true -&gt; Iterator).
     */
    boolean iterator;

    /**
     * The modCount value that the iterator believes that the backing
     * Hashtable should have.  If this expectation is violated, the iterator
     * has detected concurrent modification.
     */
    protected int expectedModCount = modCount;

    Enumerator(int type, boolean iterator) {
        this.type = type;
        this.iterator = iterator;
    }

    public boolean hasMoreElements() {
        Entry&lt;?,?&gt; e = entry;
        int i = index;
        Entry&lt;?,?&gt;[] t = table;
        /* Use locals for faster loop iteration */
        while (e == null &amp;&amp; i &gt; 0) {
            e = t[--i];
        }
        entry = e;
        index = i;
        return e != null;
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public T nextElement() {
        Entry&lt;?,?&gt; et = entry;
        int i = index;
        Entry&lt;?,?&gt;[] t = table;
        /* Use locals for faster loop iteration */
        while (et == null &amp;&amp; i &gt; 0) {
            et = t[--i];
        }
        entry = et;
        index = i;
        if (et != null) {
            Entry&lt;?,?&gt; e = lastReturned = entry;
            entry = e.next;
            return type == KEYS ? (T)e.key : (type == VALUES ? (T)e.value : (T)e);
        }
        throw new NoSuchElementException(&quot;Hashtable Enumerator&quot;);
    }
}
</code></pre>

<p>The reason why Enumerator is not fail-fast is it record the current element with index rather than reference in HashMap.</p>

<pre><code class="language-java">// HashMap

final class EntryIterator extends HashIterator
    implements Iterator&lt;Map.Entry&lt;K,V&gt;&gt; {
    public final Map.Entry&lt;K,V&gt; next() { return nextNode(); }
}

abstract class HashIterator {
    Node&lt;K,V&gt; next;        // next entry to return
    Node&lt;K,V&gt; current;     // current entry
    int expectedModCount;  // for fast-fail
    int index;             // current slot

    final Node&lt;K,V&gt; nextNode() {
        Node&lt;K,V&gt;[] t;
        Node&lt;K,V&gt; e = next;
        if (modCount != expectedModCount)
            throw new ConcurrentModificationException();
        if (e == null)
            throw new NoSuchElementException();
        if ((next = (current = e).next) == null &amp;&amp; (t = table) != null) {
            do {} while (index &lt; t.length &amp;&amp; (next = t[index++]) == null);
        }
        return e;
    }
}
</code></pre>

<h1 id="synchronized">Synchronized</h1>

<p>Hashtable is synchronized while HashMap is not. You cannot find any code related to synchronization in HashMap.java. But in Hashtable.java, keyword <code>synchronized</code> appears everywhere when you read or write.</p>

<pre><code class="language-java">// Hashtable.java

public synchronized V put(K key, V value) {
    // Make sure the value is not null
    if (value == null) {
        throw new NullPointerException();
    }

    // Makes sure the key is not already in the hashtable.
    Entry&lt;?,?&gt; tab[] = table;
    int hash = key.hashCode();
    int index = (hash &amp; 0x7FFFFFFF) % tab.length;
    @SuppressWarnings(&quot;unchecked&quot;)
    Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index];
    for(; entry != null ; entry = entry.next) {
        if ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) {
            V old = entry.value;
            entry.value = value;
            return old;
        }
    }

    addEntry(hash, key, value, index);
    return null;
    }
</code></pre>

<h1 id="null-support"><code>null</code> Support</h1>

<p>Before insert a key into Hashtable, neither the key nor the value can be <code>null</code>, which you can see from the above <code>put</code>. A <code>NullPointerException</code> will be thrown if you try to do this.</p>

<h1 id="increasing-the-capacity">Increasing the Capacity</h1>

<p>In order to accommodate and access its entries more efficiently, both HashMap and Hashtable increases the capacity when the number of keys exceeds.</p>

<p>The difference is that the new capacity of Hashtable is <code>(oldCapacity &lt;&lt; 1) + 1</code> while the one of HashMap is <code>oldCapacity &lt;&lt; 1</code>.</p>

<pre><code class="language-java">// Hashtable.java

protected void rehash() {
    int oldCapacity = table.length;
    Entry&lt;?,?&gt;[] oldMap = table;

    // overflow-conscious code
    int newCapacity = (oldCapacity &lt;&lt; 1) + 1;
    if (newCapacity - MAX_ARRAY_SIZE &gt; 0) {
        if (oldCapacity == MAX_ARRAY_SIZE)
            // Keep running with MAX_ARRAY_SIZE buckets
            return;
        newCapacity = MAX_ARRAY_SIZE;
    }
    Entry&lt;?,?&gt;[] newMap = new Entry&lt;?,?&gt;[newCapacity];

    modCount++;
    threshold = (int)Math.min(newCapacity * loadFactor, MAX_ARRAY_SIZE + 1);
    table = newMap;

    for (int i = oldCapacity ; i-- &gt; 0 ;) {
        for (Entry&lt;K,V&gt; old = (Entry&lt;K,V&gt;)oldMap[i] ; old != null ; ) {
            Entry&lt;K,V&gt; e = old;
            old = old.next;

            int index = (e.hash &amp; 0x7FFFFFFF) % newCapacity;
            e.next = (Entry&lt;K,V&gt;)newMap[index];
            newMap[index] = e;
        }
    }
}
</code></pre>

<h1 id="hash">Hash</h1>

<p>The algorithms of hash are also different in Hashtable and HashMap. For Hashtable, it use <code>hashCode()</code> method straightway and calculate the remainder divided by the length of table.</p>

<pre><code class="language-java">// Hashtable.java

private void addEntry(int hash, K key, V value, int index) {
    modCount++;

    Entry&lt;?,?&gt; tab[] = table;
    if (count &gt;= threshold) {
        // Rehash the table if the threshold is exceeded
        rehash();

        tab = table;
        hash = key.hashCode();
        index = (hash &amp; 0x7FFFFFFF) % tab.length;
    }

    // Creates the new entry.
    @SuppressWarnings(&quot;unchecked&quot;)
    Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;) tab[index];
    tab[index] = new Entry&lt;&gt;(hash, key, value, e);
    count++;
}
</code></pre>

<p>If you put a Key-Value into HashMap, it will calls <code>hash(Object)</code> method to calculate the hash value.</p>

<pre><code class="language-java">// HashMap.java

public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}

static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);
}
</code></pre>

<p>The comment says,</p>

<blockquote>
<p><code>hash(Object)</code> computes <code>key.hashCode()</code> and spreads (XORs) higher bits of hash to lower. Because the table uses power-of-two masking, sets of hashes that vary only in bits above the current mask will always collide. (Among known examples are sets of Float keys holding consecutive whole numbers in small tables.)  So we apply a transform that spreads the impact of higher bits downward.</p>
</blockquote>

<p>Finally, Hashtable is obsolete and avoid using it,  just as the official said,</p>

<blockquote>
<p>If a thread-safe implementation is not needed, it is recommended to use HashMap in place of Hashtable. If a thread-safe highly-concurrent implementation is desired, then it is recommended to use  java.util.concurrent.ConcurrentHashMap in place of Hashtable.</p>
</blockquote>
    </div>

    <footer class="post-footer">
      <div class="post-tags">
          <a href="/en/tags/java.util/">java.util</a>
          <a href="/en/tags/data-structure/">Data Structure</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/en/post/redis-mind-map/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Redis Mind Map</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/en/post/java-hashset/">
            <span class="next-text nav-default">Java HashSet</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'guoqing';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:hellokangning@hotmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/guoqing-geng-9032b820/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/hellokangning" class="iconfont icon-github" title="github"></a>
      <a href="https://www.douban.com/people/hellokangning/" class="iconfont icon-douban" title="douban"></a>
      <a href="https://www.instagram.com/hellokangning/" class="iconfont icon-instagram" title="instagram"></a>
  <a href="https://hellokangning.github.io/en/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2016 - 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Guoqing Geng</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/even.ece58db6.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-105833321-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
